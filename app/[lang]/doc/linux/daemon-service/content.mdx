# ì„œë¡ 


## Daemon Serviceë€?
ë°ëª¬ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì§ì ‘ì ìœ¼ë¡œ ì œì–´í•˜ì§€ ì•Šê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒë©´ì„œ ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§í•œë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤ê°€ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ì´ì— ì ì ˆíˆ ëŒ€ì‘í•˜ëŠ” ë¦¬ìŠ¤ë„ˆì™€ ê°™ì€ ì—­í• ì„ í•œë‹¤. ì¦‰, ë©”ëª¨ë¦¬ì— ìƒì£¼í•˜ë©´ì„œ íŠ¹ì • ìš”ì²­ì´ ì˜¤ë©´ ì¦‰ì‹œ ëŒ€ì‘ í•  ìˆ˜ ìˆë„ë¡ ëŒ€ê¸°ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë§í•œë‹¤.Â 
ì¶œì²˜: [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬](https://inpa.tistory.com/entry/í”„ë¡œì„¸ìŠ¤-ë°ëª¬-ì„œë¹„ìŠ¤-ì •ë¦¬)
Window í™˜ê²½ì—ì„œ ìœ„ ê°œë…ì„ Service ëª…ì¹­ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

## Create systemd service
ìš°ë¦¬ëŠ” ê°„ë‹¨íˆ `echo`` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” MyAppì´ë¼ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.
```bash
$ sudo vi /usr/local/bin/myapp.sh

#!/bin/bash
echo 'MyApp is Started' | systemd-cat -t MyApp -p info
sleep 5
echo 'MyApp is Crashed' | systemd-cat -t MyApp -p err
```

### Options

#### Restart 
```bash
man systemd.service
``` 
ë©”ë‰´ì–¼ì„ í™•ì¸ í•´ë´…ì‹œë‹¤. Options ì˜ Restart= ì˜µì…˜ ì„¹ì…˜ì„ ë³´ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¢…ë£Œ ìƒíƒœì— ë”°ë¼ ì¬ì‹œì‘ ì—¬ë¶€ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì—ëŸ¬, íƒ€ì„ì•„ì›ƒ, ì„±ê³µ ë“±ì˜ ìƒíƒœì— ë”°ë¼ ì¬ì‹œì‘ ì—¬ë¶€ë¥¼ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
default ëŠ” no ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” always ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

#### RestartSec
Options ì˜ RestartSec= ì˜µì…˜ ì„¹ì…˜ì„ ë³´ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¬ì‹œì‘ ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ìŠˆê°€ ìˆì„ë•Œ ë¶„ë‹¹ 100ë²ˆì˜ ì¬ì‹œì‘ì„ ì‹œë„í•˜ë©´ ì‹œìŠ¤í…œì— ë¶€í•˜ê°€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
default ëŠ” 100ms ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” 5ì´ˆë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ Examplesë¥¼ í†µí•´ ì–´ë–¤ ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.
```bash
EXAMPLES
       Example 1. Simple service

       The following unit file creates a service that will execute /usr/sbin/foo-daemon. Since no Type= is specified, the default Type=simple will be assumed.
       systemd will assume the unit to be started immediately after the program has begun executing.

           [Unit]
           Description=Foo

           [Service]
           ExecStart=/usr/sbin/foo-daemon

           [Install]
           WantedBy=multi-user.target
```
ì„œë¹„ìŠ¤ëŠ” ì„¸ê°œì˜ ì„¹ì…˜ìœ¼ë¡œ êµ¬ì„±ë˜ë„¤ìš”
* Unit: ì„œë¹„ìŠ¤ì˜ ì´ë¦„, ì„¤ëª…, ì¢…ì†ì„± ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
* Service: ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•  ëª…ë ¹ì–´, í™˜ê²½ ë³€ìˆ˜, ì‘ì—… ë””ë ‰í† ë¦¬ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
* Install: ì„œë¹„ìŠ¤ë¥¼ ì–´ë–»ê²Œ ì„¤ì¹˜í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.

ì´ì œ ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.

> We can use one of the already existing service unit files so we can use something from this location
> ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ì„œë¹„ìŠ¤ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„±ê²©ì´ ìœ ì‚¬í•œ ì„œë¹„ìŠ¤ë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
ls /lib/systemd/system
```
ã…‹ã…‹ ìš°ë¦° `sshd.service` ë¥¼ ì°¸ê³ í•´ë³´ê² ìŠµë‹ˆë‹¤.
<CodeHeader text="$ sudo cp /etc/systemd/system/sshd.service  /etc/systemd/system/myapp.service" /> 

```bash
[Unit]
Description=OpenBSD Secure Shell server
After=network.target auditd.service
ConditionPathExists=!/etc/ssh/sshd_not_to_be_run

[Service]
EnvironmentFile=-/etc/default/ssh
ExecStartPre=/usr/sbin/sshd -t
ExecStart=/usr/sbin/sshd -D $SSHD_OPTS
ExecReload=/usr/sbin/sshd -t
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
Restart=on-failure
RestartPreventExitStatus=255
Type=notify
RuntimeDirectory=sshd
RuntimeDirectoryMode=0755

[Install]
WantedBy=multi-user.target
Alias=sshd.service
```
ssh daemon ì„œë¹„ìŠ¤ì˜ ì„¸ê°€ì§€ ì„¹ì…˜ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- __[Unit]__
  - After: ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    - network.target: ë„¤íŠ¸ì›Œí¬ê°€ ì¤€ë¹„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
    - auditd.service: auditd ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
  - ConditionPathExists: ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— íŠ¹ì • ê²½ë¡œì— íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    - !/etc/ssh/sshd_not_to_be_run: í•´ë‹¹ ê²½ë¡œì— íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
- __[Service]__
  - ExecReload: ê´€ë¦¬ìê°€ `systemctl reload myapp.service` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
  - KillMode: ì„œë¹„ìŠ¤ê°€ ì¢…ë£Œ(`systemctl stop`)ë  ë•Œ ì–´ë–»ê²Œ ì¢…ë£Œí• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.
    - process: main í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
    - control-group: í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹(ì´ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ìƒì„±ëœ ëª¨ë“  í”„ë¡œì„¸ìŠ¤)ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
    - mixed: í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ì„ ì¢…ë£Œí•˜ê³ , í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì§€ ì•Šìœ¼ë©´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
    - none: í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - RestartPreventExitStatus: ì„œë¹„ìŠ¤ê°€ ì¢…ë£Œë  ë•Œ ì–´ë–¤ ìƒíƒœì—ì„œëŠ” ì¬ì‹œì‘í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ 255ì™€ ê°™ì€ ì¢…ë£Œ ì½”ë“œë¥¼ ë˜ì§€ë©´ systemdì—ê²Œ ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì§€ ë§ë¼ê³  ë§í•˜ì„¸ìš”.
  - Type: ì„œë¹„ìŠ¤ì˜ ì¢…ë¥˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    - simple: ê¸°ë³¸ê°’ì…ë‹ˆë‹¤. ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ë©´ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ ì‹œì‘ë©ë‹ˆë‹¤.
    - forking: í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ëŠ” ì¢…ë£Œë©ë‹ˆë‹¤.
    - oneshot: í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ foregroundì—ì„œ í•œ ë²ˆ ì‹¤í–‰ë˜ê³  ì¢…ë£Œë©ë‹ˆë‹¤.
    - notify: í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ ì‹œì‘ë˜ë©´ systemdì—ê²Œ ì•Œë¦½ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ sd_notify()ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 
    - dbus: í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ê°€ D-Bus ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.


ìŒ ë‚˜ë¨¸ì§„ ë©”ë‰´ì–¼ë³´ë©´ì„œ ì°¸ê³ í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
```bash
[Unit]
Description=My App created by seongpilChoi
After=network.target auditd.service

[Service]
ExecStartPre=/usr/local/bin/myapp-pre.sh
ExecStart=/usr/local/bin/myapp.sh
KillMode=process
Restart=always
RestartSec=1
Type=simple

[Install]
WantedBy=multi-user.target
```
wq ë¡œ ì €ì¥í•˜ê³  ë‚˜ì˜µì‹œë‹¤.. í•´ë³¼ê¹Œìš”?
```bash
$ sudo systemctl daemon-reload
$ sudo systemctl start myapp.service
$ sudo systemctl status myapp.service

â— myapp.service - My App created by seongpilChoi
   Loaded: loaded (/etc/systemd/system/myapp.service; disabled; vendor preset: enabled)
   Active: active (running) since Mon 2024-01-22 01:46:13 KST; 2s ago
  Process: 19216 ExecStartPre=/usr/local/bin/myapp-pre.sh (code=exited, status=0/SUCCESS)
 Main PID: 19222 (myapp.sh)
    Tasks: 2 (limit: 4915)
   CGroup: /system.slice/myapp.service
           â”œâ”€19222 /bin/bash /usr/local/bin/myapp.sh
           â””â”€19227 sleep 5

Jan 22 01:46:13 michelle myapp-pre.sh[19216]: Systemd is preparing to start MyApp
Jan 22 01:46:13 michelle systemd[1]: Started My App created by seongpilChoi.
Jan 22 01:46:13 michelle MyApp[19225]: MyApp is Started
```
ìƒì„±ëœ ë©”ì¸ PID, forked ëœ PID ë“¤ì´ ë³´ì¸ë‹¤
ì„¤ì •í•œ ë¡œê·¸ë“¤ë„ ì˜ ë³´ì´ë‹ˆ ì°¸ ì¢‹ë‹¤.
```bash
$ journalctl -u myapp.service
```
í•˜ì§€ë§Œ ì •ìƒ ë¡œê·¸ë§Œ í‘œì‹œë˜ê³  ì—ëŸ¬ ë¡œê·¸ëŠ” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.  
-f ì˜µì…˜ì„ ì£¼ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```bash
journalctl -f
```

ë§‰ìƒ ë§Œë“¤ê³  ë³´ë‹ˆ, ì–´ë ¤ìš´ ë¶€ë¶„ì€ í•„ìš”í•œ ì˜µì…˜ì„ ì°¾ëŠ” ê²ƒì´ì—ˆë‹¤.  
í•˜ì§€ë§Œ ì‹œìŠ¤í…œì´ ë¬´ì—‡ì„ í•˜ê¸°ë¥¼ ì›í•˜ëŠ”ì§€ ì•„ëŠ” í•œ, ëª¨ë“  ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤ëŠ” ë¬¸êµ¬ê°€ ë³´ì¸ë‹¤..
18


# Questions

### Make sure rpcbind.service unit automatically starts up after Linux boots.
```bash
Make sure rpcbind.service unit automatically starts up after Linux boots.
[bob@centos-host ~]$ systemctl status rpcbind.service
â— rpcbind.service - RPC Bind
   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; disabled; vendor preset: enabled)
   Active: active (running) since Mon 2024-01-22 10:29:52 UTC; 37min ago
     Docs: man:rpcbind(8)
 Main PID: 599 (rpcbind)
    Tasks: 1 (limit: 1340692)
   Memory: 1.1M
   CGroup: /system.slice/rpcbind.service
           â””â”€599 /usr/bin/rpcbind -w -f

```
disabled ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
ì¸ì ë³´ê³  ëŒ€ì¶© ë§ëŠ”ê±° ë³´ì
```bash
systemctl --help
sudo systemctl enable rpcbind.service
```


### Create a script called script.sh. This script should create a tar archive called archive.tar.gz. The script should archive the directory called dir1.
í  gz ë°©ì‹ì˜ ì••ì¶•ì„ í•´ì•¼í•œë‹¤. `tar --help`ì¤‘ 
suffixì— ë”°ë¼ auto compress ì§€ì›í•˜ëŠ” í•­ëª©(a)ì´ ìˆë‹¤.
ìƒˆë¡œìš´ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” cì™€  ì••ì¶• ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” fë¥¼ ì‚¬ìš©í•˜ì—¬ tar íŒŒì¼ì„ ìƒì„±í•œë‹¤.
<CodeHeader text="script.sh" /> 

```bash
#!/bin/bash

tar acf archive.tar.gz dir1
```
ì§€ê¸ˆê¹Œì§€ í†µê³¼ê°€ì™œì´ë¦¬ ì•ˆë˜ë‚˜ í–ˆë”ë‹ˆ
```bash
$ chmod a+x script.sh
```
ì¦‰ì‹œ ì‹¤í–‰ í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆì–´ì•¼ í–ˆë‹¤..


### Under bob's home: Create script2.sh script that displays if the sshd.service unit is enabled or disabled.
```bash
$ sudo systemctl --help

Unit File Commands:
  list-unit-files [PATTERN...]        List installed unit files
  enable [UNIT...|PATH...]            Enable one or more unit files
  disable UNIT...                     Disable one or more unit files
  reenable UNIT...                    Reenable one or more unit files
  preset UNIT...                      Enable/disable one or more unit files
                                      based on preset configuration
  preset-all                          Enable/disable all unit files based on
                                      preset configuration
  is-enabled UNIT...                  Check whether unit files are enabled
  mask UNIT...                        Mask one or more units
  unmask UNIT...                      Unmask one or more units
  link PATH...                        Link one or more units files into
                         
```
`Check whether unit files are enabled` ì´ê±°ë‹¤

<CodeHeader text="script2.sh" /> 

```bash
#!/bin/bash
sudo systemctl is-enabled sshd.service
```

### Create a script /home/bob/perm.sh. This script should set permissions on /home/bob/dir8 directory so that user owner only has x (execute) permissions, group owner and others must not have any permissions at all. 

Create perm.sh script:

```bash
vi /home/bob/perm.sh
```
add below given code in it:

```bash
#!/bin/bash
chmod 0100 /home/bob/dir8
```


Make it executable:
```bash
chmod u+x /home/bob/perm.sh
```


### httpd is already installed, mask its service.
```bash
$ sudo systemctl mask httpd.service
```

### Now unmask the httpd service.
```bash
$ sudo systemctl unmask httpd.service
```


### We made some changes on httpd unit file i.e /usr/lib/systemd/system/httpd.service and after that we are getting some warnings while running systemctl status httpd command. Fix the same and make sure this command works without any warning.

```bash
$ systemctl status httpd
Warning: The unit file, source configuration file or drop-ins of httpd.service changed changed on disk. Run 'systemctl daemon-reload '

â— httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabl>
   Active: active (running) since Mon 2024-01-22 11:50:59 UTC; 1min 22s ago
     Docs: man:httpd.service(8)
 Main PID: 4595 (httpd)
   Status: "Running, listening on: port 80"
    Tasks: 213 (limit: 1340692)
   Memory: 19.6M
   CGroup: /system.slice/httpd.service
           â”œâ”€4595 /usr/sbin/httpd -DFOREGROUND
           â”œâ”€4609 /usr/sbin/httpd -DFOREGROUND
           â”œâ”€4610 /usr/sbin/httpd -DFOREGROUND
           â”œâ”€4611 /usr/sbin/httpd -DFOREGROUND
           â””â”€4612 /usr/sbin/httpd -DFOREGROUND
```
ìŒ ë”±íˆ ì´ìƒí•œê±´ ì•ˆë³´ì´ëŠ”ë””..
```bash
sudo journalctl -u httpd
```
ã…‹ã…‹ã…‹ ìˆì—ˆë„¤


ë‹¤ì‹œ ì˜¬ë ¤ë³´ì
```bash
$ sudo systemctl daemon-reload
$ sudo systemctl restart httpd
```
