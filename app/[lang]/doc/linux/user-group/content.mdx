# Intro
* 리눅스에서는 사용자와 그룹을 구분하여 관리한다.  
* 사용자는 파일이나 디렉토리에 대한 접근 권한을 가지고 있으며, 그룹은 사용자를 묶어서 관리하는 역할을 한다.  
* 사용자와 그룹은 각각 고유한 식별 번호를 가지고 있으며, 이를 UID와 GID라고 한다. 
* 
### 관련 파일

* /etc/group 파일에 기록되어 있으며, 그룹에 속한 사용자는 /etc/group 파일에서 확인할 수 있다. 
* /etc/shadow 파일에 기록되어 있는 암호화된 비밀번호를 가지고 있다. 
* /etc/gshadow 파일에 기록되어 있는 암호화된 그룹 비밀번호를 가지고 있다. 
* 사용자와 그룹은 /etc/login.defs 파일에 기록되어 있는 암호화된 비밀번호를 가지고 있다. 
* 사용자와 그룹은 /etc/default/useradd 파일에 기록되어 있는 암호화된 비밀번호를 가지고 있다. 


## User 추가 / 삭제 / 삭제 / 수정

### 사용자 추가
* 사용자를 추가하는 방법은 useradd 명령을 사용한다.
* useradd 명령은 사용자를 추가할 때 필요한 파일을 생성하고, 사용자의 홈 디렉토리를 생성한다.(기본적으로 /home/사용자이름)
* 유저를 생성하면 해당 이름의 그룹도 생성된다.

```bash
$ sudo useradd [옵션] 사용자이름
# specify the user's uid, gid
$ sudo useradd -u 1001 -g 1002 사용자이름
```

`/etc/skel` 디렉토리는 유저가 생성된후, 홈 디렉토리가 생성될 때 기본적으로 복사되는 파일들이 저장되어 있는 디렉토리이다.  
`/etc/default/useradd` 파일에 기록되어 있는 암호화된 비밀번호를 가지고 있다.
이처럼 유저의 기본 설정을 보고싶다면 아래 명령어를 실행해보자.  
```bash
$ useradd --defaults 
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/sh
SKEL=/etc/skel
CREATE_MAIL_SPOOL=no
$ cat /etc/login.defs
```

만약 홈 디렉토리와 쉘을 지정하고 싶다면 아래와 같이 옵션을 추가한다.
```bash
$ sudo useradd --home-dir /home/사용자이름 -s /bin/bash 사용자이름
```
생성한 유저의 상세 정보는 /etc/passwd(사용자 이름, UID, GID, 홈 디렉토리, 쉘 정보) 파일에 기록되어 있다.  
```bash
$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
testuser:x:1001:1002:testuser must be delete after test is finished:/home/abacus:/bin/bash
dhjoe:x:1002:998::/home/abacus:/bin/bash
```
* delimeter는 콜론(:)이다.
* 1번째는 사용자 이름, 2번째는 암호화된 비밀번호, 3번째는 UID, 4번째는 GID, 5번째는  user description or comment field., 6번째는 홈 디렉토리, 7번째는 쉘 정보이다.

```bash
$ sudo passwd 사용자이름
```

#### 사용자 삭제
* 사용자를 삭제하는 방법은 userdel 명령을 사용한다.

```bash
$ sudo userdel 사용자이름
```
사용자가 삭제되더라도 홈 디렉토리는 삭제되지 않는다.
홈 디렉토리까지 삭제하려면 -r 옵션을 사용한다.

```bash
$ sudo userdel -r 사용자이름
```
우린 이제 각 디렉토리가 누구의 소유인지 UID, GID를 확인 할 수있다
```bash
$ ls -ln /home
total 0
drwx------ 2 1001 1002 40  9월  9 16:26 testuser
drwx------ 2 1002 998  40  9월  9 16:26 dhjoe
```
로그인한 사용자는 내가 누구인지 확인할 수 있다.
```bash
$ whoami
dhjoe
$ id
uid=1002(dhjoe) gid=998 groups=998 ...
```
그 밖에 우리는 다른 타입의 사용자를 정의 할 수있다 GCP의 서비스 어카운트, Habor의 robot account 등 과같이
리눅스에서도 시스템 사용자를 정의 할 수 있다.
```bash
$ sudo useradd --system /bin/false 사용자이름
```
> 보통 system user 의 uid, gid는 1000 이하로 정의한다.

### 유저 수정
* 유저를 수정하는 방법은 기본적으로 usermod 명령을 사용한다.

```bash
$ sudo usermod [옵션] 사용자이름

# 사용자의 홈 디렉토리를 변경하고 싶다면 -d 옵션을 사용한다.
$ sudo usermod -d /home/사용자이름 사용자이름

$ sudo usermod --home /home/other --move-home 사용자이름

# 잠금 처리
$ sudo usermod -L 사용자이름
# 잠금 해제
$ sudo usermod -U 사용자이름

# 유저가 2021년 9월 9일에 만료되도록 설정
$ sudo usermod -e 2021-09-09 사용자이름

# 유저의 비밀번호를 만료되도록 설정
$ sudo chage -d 0 사용자이름

# 2021년 9월 9일에 유저의 비밀번호를 만료되도록 설정
# change age
$ sudo chage -E 2021-09-09 사용자이름

```

#### 패스워드 변경
* 패스워드를 변경하는 방법은 passwd 명령을 사용한다.

```bash
$ sudo passwd 사용자이름
```


좋다 이제 그룹의 세계로 넘어가보자



## Group 추가 / 삭제 / 수정
그룹으로 뭘 할 수 있을까?
* 그룹은 사용자를 묶어서 관리하는 역할을 한다.
*  시스템에서 거의 모든 작업을 수행할 수 있는 휠 또는 의사 그룹이다.
  * 가장 강력한 사용자 계정인 루트를 사용하여 루트 권한으로 모든 프로그램을 실행할 수 있습니다.
  * 또 다른 하나는 Docker 컨테이너를 관리할 수 있는 Docker 그룹의 사용자입니다.
사용자는 여러 그룹에 속할 수 있지만 이러한 그룹 중 하나는 특별합니다(Primary). 그 중 하나는 기본 그룹이고 나머지는 모두 보조 또는 보충 그룹입니다. 기본 그룹을 로그인 그룹이라고도 합니다. 사용자가 로그인하자마자 이 그룹이 자신의 메인 그룹이 되기 때문입니다. 하지만 이론만으로는 이해하기 어렵습니다. 그럼 이 기본 그룹의 특별한 점을 살펴보겠습니다.
---
사용자가 프로그램을 실행하면 해당 사용자 계정과 그룹에서 실행됩니다.
그렇지 않으면 사용자 계정과 기본 그룹이 가지고 있는 것과 동일한 권한으로 프로그램이 실행됩니다.  

다른 예로는 사용자가 파일을 만들 때 이 파일은 사용자 계정과 기본 또는 로그인 그룹에 의해 자동으로 소유됩니다.

### 그룹 조회
* 그룹을 조회하는 방법은 `groups` 명령을 사용한다.

```bash
$ groups
abacus adm cdrom sudo dip plugdev lxd docker
# list of users 
$ users
abacus 

```



### 그룹 추가
* 그룹을 추가하는 방법은 groupadd 명령을 사용한다.

```bash
$ sudo groupadd 그룹이름
sudo groupadd testGroup

# add user to group
$ sudo usermod -aG testGroup abacus

# check group
$ groups abacus
abacus : abacus testGroup

```
first group is primary group, second group is secondary group

### 그룹 삭제
* 그룹을 삭제하는 방법은 `gpasswd` 명령을 사용한다.

```bash
$ sudo gpasswd -d 사용자이름 그룹이름
$ sudo groupdel 그룹이름
```

### 그룹 수정
* 그룹을 수정하는 방법은 `groupmod` 명령을 사용한다.

```bash
$ sudo groupmod [옵션] 그룹이름

# 그룹의 이름을 변경하고 싶다면 -n 옵션을 사용한다.
$ sudo groupmod -n 새로운그룹이름 기존그룹이름
$ sudo groupmod --new-name programmers testGroup

# change primary group
$ sudo usermod --gid 그룹이름 사용자이름
$ sudo suermod -g testGroup abacus
```
만약 삭제하려는 그룹이 누군가의 기본 그룹이라면 삭제할 수 없다.
```bash
$ sudo groupdel testGroup
groupdel: cannot remove the primary group of user 'abacus'

$ sudo usermod -g abacus abacus
$ sudo groupdel testGroup
done
```

